# SubTask 1 Teach the callback to build RecordBatches
• In callback_wrapper.rs (or where CallbackWrapper lives) replace the body of __call__.
– Capsule path: create an ArrowArrayStreamReader, collect all RecordBatches into Vec<RecordBatch>, capture its Schema, and store the tuple (batches, schema) in an ArrowQueryResult.
– IPC-bytes path: after table = reader.read_all() call table.to_batches(); convert to Vec<RecordBatch>, get table.schema(), wrap in the same tuple.
– Tuple-fallback path: build a PyArrow pa.Table.from_pylist() from the rows, then to_batches(), follow the same steps.
• For the transition keep the old (schema_desc, rows) build as well and wrap both in a temporary struct:
```
struct WorkerReturn {
    arrow: ArrowQueryResult,
    legacy: (Vec<HashMap<String,String>>, Vec<Vec<Option<String>>>),
}
```
• Adjust CallbackWrapper to send this WorkerReturn through the existing oneshot::Sender.

# SubTask 2 Widen WorkerMessage::Query and PythonWorker::on_query
• Change the Query variant’s responder to oneshot::Sender<WorkerReturn>.
• Update PythonWorker::on_query to propagate that new type.
• Provide a helper in PythonWorker
fn unwrap_arrow(res: WorkerReturn) -> ArrowQueryResult { res.arrow }
so call-sites stay simple.
• cargo check must pass.

# SubTask 3 Cut QueryRunner over to the Arrow half of WorkerReturn
• Inside DirectQueryRunner::execute and RouterQueryRunner::execute call unwrap_arrow(worker_return) and ignore legacy.
• Delete any remaining call to rows_to_record_batch etc.
• Run unit tests; repository must compile.

# SubTask 4 Remove legacy row machinery
• Delete the temporary legacy field in WorkerReturn, the struct itself, and the whole string-building logic inside CallbackWrapper.
• Revert WorkerMessage::Query responder back to oneshot::Sender<ArrowQueryResult> and propagate that narrower type through PythonWorker, on_query, and the callback.
• Remove all unused imports (HashMap, arrow_value_to_string, etc.).
• Perform cargo check and cargo test to confirm a clean build with no leftover string path.